(function( $ ){
    $.fn.formValidator=function(onValidated,options){
        jQuery(this).each(function(){
            dt={
                "required"      :"required",/*validates if it's mandatory*/
                "email"         :"email",/*validates an e-mail*/
                "alpha"         :"alpha",/*validates normal characters*/
                "uppercase"     :"uppercase",/*validates if there are uppercase*/
                "lowercase"     :"minusculas",/*validates if there are lowercase*/
                "special"       :"especial",/*validates if there are special characters*/
                "decimal"       :"decimal",/*validates decimal numbers*/
                "entero"        :"integer",/*validates integer numbers*/
                "thousand"      :"thousand",/*validates thousands separator*/
                "eol"           :"<br/>",/*defines the newline */
                /*{fieldname} is automatically replaced by the evaluated field name*/
                "msgrequired"   :"El campo {fieldname} es obligatorio.",/*message when field is mandatory*/
                "msginvalid"    :"El campo {fieldname} no es v√°lido.",/*message when field is invalid*/
                "sepdecimal"    :".",/*defines the decimal separator*/
                "sepmiles"      :"'",/*defines the thousands separator*/
                "fieldname"     :"alt"/*the attribute where the Field Name is obtained. I recommend, don't touch it*/
            };
            st=$.extend(dt,options);
            eol=st["eol"];
            isempty=function(ctl){
                if(ctl!=null && ctl!="")
                    if(ctl.split(" ").join("")=="") 
                        return true;
                    else
                        return false;
                else
                    return true;
            }
            checknumber=function(a){
                cumple=true;
                s=$(a).val();
                for (i = 0; i < s.length; i++){
                    c = s.charAt(i);
                    if(!(parseInt(c) >= 0 && parseInt(c) <= 9) && c!=st["sepdecimal"] && c!=st["sepmiles"]){
                        cumple=false;
                    }
                }
                if(cumple){
                    /*checo formatos*/
                    t=s.split(st["sepdecimal"]);
                    m=s.split(st["sepmiles"]);
                    if(t.length>2){
                        if(t[1].indexOf(st["sepmiles"]));
                        cumple=false;
                    }
                    else{
                        if($(a).hasClass(st["entero"]) && t.length!=1){
                            cumple=false;
                        }
                        if($(a).hasClass(st["thousand"])){
                            cumple=true;
                            for(i=0;i<m.length;i++){
                                gm=m[i];
                                if(gm.length!=3 && i>1){
                                    cumple=false;
                                }
                            }
                        }
                    }
                }else
                    cumple=false;
                return cumple;
            }
            addcadena=function(c,d,h){
                for(i=d;i<=h;i++){
                    c=c.concat(String.fromCharCode(i));
                }
                return c;
            }
            jQuery(this).submit(function(){
                mensaje="";
                invalidados=new Array();
                $(this).find("*").each(function(){
                    erroreslocales=new Array();
                    valido=true;
                    conformato=false;
                    mensajeaux="";
                    cars=new Array();
                    formato=true;
                    s=jQuery(this).val();
                    /*validaciones especiales*/
                    auxfunction=st[this.id+"_validate"];
                    if(auxfunction && $(this).val()!=""){
                        mensajeaux=auxfunction(this);
                        if(mensajeaux){
                            mensaje+=mensajeaux.toString();
                            erroreslocales.push(mensajeaux.toString());
                            valido=false;
                        }
                    }
                    /*requeridos*/
                    if($(this).hasClass(st["required"])){
                        if(isempty(s)){
                            mensajeaux=st["msgrequired"].split("{fieldname}").join($(this).attr(st["fieldname"]))+st["eol"];
                            mensaje+=mensajeaux;
                            erroreslocales.push(mensajeaux.toString());
                            valido=false;
                        }
                    }

                    /*numeros*/
                    if($(this).hasClass(st["entero"]) || $(this).hasClass(st["thousand"]) || $(this).hasClass(st["decimal"])){
                        if(checknumber(this)==true){
                            cars=addcadena(cars,48, 57);
                            if($(this).hasClass(st["thousand"]))
                                cars=addcadena(cars,String.charCodeAt(st["sepmiles"]), String.charCodeAt(st["sepmiles"]));
                            if($(this).hasClass(st["decimal"]))
                                cars=addcadena(cars,String.charCodeAt(st["sepdecimal"]), String.charCodeAt(st["sepdecimal"]));
                        }else
                            formato=false;
                    }
                    /*email*/
                    if(jQuery(this).hasClass(st["email"])){
                        if(jQuery(this).val()!=""){
                            r=jQuery(this).val();
                            arroba=r.split("@");
                            if(arroba.length>1)
                                punto=arroba[1].indexOf(".");
                            len=r.length;
                            if(!isempty(r))
                                if(len<=3 || arroba.length<2 || punto<=2){
                                    formato=false;
                                }
                        }
                    /*if(formato==true){
                    cars=addcadena(cars,33,64);
                    cars=addcadena(cars,91,96);
                    cars=addcadena(cars,123,256);
                }*/
                    }
                    /*cadenas*/
                    if($(this).hasClass(st["alpha"])){
                        cars=addcadena(cars,65,90);/*may*/
                        cars=addcadena(cars,97,122);/*min*/
                    }else{
                        if($(this).hasClass(st["lowercase"]))
                            cars=addcadena(cars,97,122);
                        if($(this).hasClass(st["uppercase"]))
                            cars=addcadena(cars,65,90);
                    }
                    if($(this).hasClass(st["special"])){
                        cars=addcadena(cars,33,64);
                        cars=addcadena(cars,91,96);
                        cars=addcadena(cars,123,256);
                    }
                    if(formato && cars.length>0){
                        for(i=0;i<s.length;i++){
                            x=s.toString().charAt(i);
                            xyz=false;
                            for(j=0;j<cars.length;j++){
                                if(cars[j]==x)
                                    xyz=true;
                            }
                            if(xyz==false){
                                mensajeaux+=st["msginvalid"].split("{fieldname}").join($(this).attr(st["fieldname"]))+st["eol"];
                                erroreslocales.push(mensajeaux);
                                mensaje+=mensajeaux;
                                valido=false;
                                break;
                            }
                        }
                    }else{
                        if(!formato){
                            mensajeaux+=st["msginvalid"].split("{fieldname}").join($(this).attr(st["fieldname"]))+st["eol"];
                            erroreslocales.push(mensajeaux);
                            mensaje+=mensajeaux;
                            valido=false;
                        }
                    }
                    if(valido==false){
                        objerr=new Object();
                        objerr.obj=this;
                        objerr.errors=erroreslocales;
                        invalidados.push(objerr);
                    }
                });
                if(mensaje.split(" ").join("").split("\n").join("")==""){
                    /*mision cumplida*/
                    return onValidated("");
                }else{
                    /*mision fallida*/
                    onValidated(mensaje,invalidados);
                    return false;
                }
            });
        })
    
    };
})( jQuery );